<script>
  async function getSignature() {
    const response = await fetch('https://www.crunchtowncollection.com/_functions/getCloudinarySignature', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    if (!response.ok) {
      throw new Error('Failed to fetch signature');
    }
    return response.json();
  }

  async function uploadFile() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) {
      document.getElementById('message').innerText = 'Please select a file first.';
      return;
    }

    try {
      const { signature, apiKey, timestamp } = await getSignature();

      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', 'Crunchtown_Upload');
      formData.append('api_key', apiKey);
      formData.append('timestamp', timestamp);
      formData.append('signature', signature);

      const response = await fetch('https://api.cloudinary.com/v1_1/dvekrw4yu/image/upload', {
        method: 'POST',
        body: formData
      });
      const data = await response.json();
      document.getElementById('message').innerText = `Upload successful! Image dimensions: ${data.width}x${data.height}`;
    } catch (error) {
      console.error('Error uploading file:', error);
      document.getElementById('message').innerText = 'Upload failed. Please try again.';
    }
  }
</script>
